
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Data &amp; Volumes &#8212; Kun Zhou Space</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Networks &amp; Requests" href="03-networks-requests.html" />
    <link rel="prev" title="Images &amp; Containers" href="01-images-containers.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo_normal_distribution.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Kun Zhou Space</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  About me
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../about-me/cv.html">
   Short CV
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../about-me/publications.html">
   Publications
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Geometry
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../geometry/point-to-line-distance.html">
   Distance from a point to a line
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Deep Learning
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../deep-learning/neurons_and_layers.html">
   Optional Lab - Neurons and Layers
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Docker
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01-images-containers.html">
   Images &amp; Containers
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Data &amp; Volumes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03-networks-requests.html">
   Networks &amp; Requests
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Github
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../github/multiple-github-accounts-ssh.html">
   Using Multiple GitHub Accounts and SSH Keys
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../github/undo-changes.html">
   Undo Changes in Git: git checkout, git revert, &amp; git reset
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Java
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Java/manage-multiple-java-version-MacOs.html">
   How to Manage Multiple Java Versions in MacOS
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/kunzhoudk/kzspace"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/kunzhoudk/kzspace/issues/new?title=Issue%20on%20page%20%2Fdocker/02-data-volumes.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/docker/02-data-volumes.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#volumes">
   Volumes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#removing-anonymous-volumes">
   Removing Anonymous Volumes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bind-mounts">
   Bind Mounts
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#key-docker-commands">
   Key Docker Commands
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Data & Volumes</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#volumes">
   Volumes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#removing-anonymous-volumes">
   Removing Anonymous Volumes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bind-mounts">
   Bind Mounts
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#key-docker-commands">
   Key Docker Commands
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="data-volumes">
<h1>Data &amp; Volumes<a class="headerlink" href="#data-volumes" title="Permalink to this headline">#</a></h1>
<p>Images are read-only - once they’re created, they can’t change, or you have to rebuild them to
update them.
<strong>Containers on the other hand can read and write</strong> - they add a thin “read-write layer” on top of the image. That means that they can make changes to the files and folders in the image without actually changing the image.
But even with read-write Containers, <strong>two big problems</strong> occur in many applications using Docker:</p>
<ol class="simple">
<li><p><strong>Data written in a Container doesn’t persist</strong>: If the Container is stopped and removed, all data written in the Container is lost</p></li>
<li><p><strong>The container can’t interact with the host filesystem</strong>: If you change something in your host project folder, those changes are not reflected in the running container. You need to rebuild the image (which copies the folders) and start a new container</p></li>
</ol>
<p>Problem 1 can be solved with a Docker feature called “Volumes”. Problem 2 can be solved by using “Bind Mounts”.</p>
<section id="volumes">
<h2>Volumes<a class="headerlink" href="#volumes" title="Permalink to this headline">#</a></h2>
<p>Volumes are folders (and files) managed on your host machine which are <strong>connected</strong> to folders / files inside of a container. Changes in either folder / files will be reflected in the other one. Volumes persist if a container shuts down. If a container (re-)starts and mounts a volume, any data inside of that volume is available in the container. A container can write data into volume and read data from it. A defined path in the container is mapped to the created volume/mount. e.g. <em>/some-path</em> on your hosting machine is mapped to /<em>app/data</em> in the container. Docker sets up a <em>/some-path</em> on your host machine, exact location is unknown to you. You can manage it via <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">volume</span></code> commands.</p>
<p>There are <strong>two types of Volumes</strong>:</p>
<ul class="simple">
<li><p>Anonymous Volumes: Created via -v /some/path/in/container and removed automatically when a container is removed because of <code class="docutils literal notranslate"><span class="pre">--rm</span></code> added on the docker run command. It is created specially for a single container and cannot be shared across containers. Since it is anonymous, it can’t be reused, even on same image.</p></li>
<li><p>Named Volumes: Created via -v some-name:/some/path/in/container and NOT removed automatically. Greate for data which should be persistent but which you don’t need to edit directly. It is created in general - not tied to any specific container and can be shared across containers</p></li>
</ul>
<p>With Volumes, <strong>data can be passed into a container</strong> (if the folder on the host machine is not empty) and it can be saved when written by a container (changes made by the container are reflected on your host machine).</p>
<p><strong>Volumes are created and managed by Docker</strong> - as a developer, you don’t necessarily know where exactly the folders are stored on your host machine. Because the data stored in there is <strong>not meant to be viewed or edited by you</strong> - use “Bind Mounts” if you need to do that!</p>
<p>Instead, especially Named Volumes can help you with persisting data. Since data is not just written in the container but also on your host machine, the data survives even if a container is removed (because the Named Volume isn’t removed in that case). Hence, you can use Named Volumes to persist container data (e.g. log files, uploaded files, database files etc).</p>
<p>Anonymous Volumes can be useful for ensuring that some Container-internal folder is <strong>not overwritten</strong> by a “Bind Mount” for example.</p>
<p>By default, <strong>Anonymous Volumes are removed</strong> if the Container was started with the –rm option and was stopped thereafter. They are <strong>not removed</strong> if a Container was started (and then removed) without that option.</p>
<p><strong>Named Volumes are never removed</strong>, you need to do that manually (via <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">volume</span> <span class="pre">rm</span> <span class="pre">VOL_NAME</span></code> , see reference below).</p>
</section>
<section id="removing-anonymous-volumes">
<h2>Removing Anonymous Volumes<a class="headerlink" href="#removing-anonymous-volumes" title="Permalink to this headline">#</a></h2>
<p>We saw, that anonymous volumes are removed automatically, when a container is removed.</p>
<p>This happens when you start / run a container with the <code class="docutils literal notranslate"><span class="pre">--rm</span></code> option.</p>
<p>If you start a container <strong>without that option</strong>, the anonymous volume would <strong>NOT be removed</strong>, even if you remove the container (with <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">rm</span> <span class="pre">...</span></code> ).</p>
<p>Still, if you then re-create and re-run the container (i.e. you run <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span> <span class="pre">...</span></code> again), <strong>a new anonymous volume will be created</strong>. So even though the anonymous volume wasn’t removed automatically, it’ll also <strong>not be helpful</strong> because a different anonymous volume is attached the next time the container starts (i.e. you removed the old container and run a new one).</p>
<p>Now you just start <strong>piling up a bunch of unused anonymous volumes</strong> - you can <strong>clear them</strong> via <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">volume</span> <span class="pre">rm</span> <span class="pre">VOL_NAME</span></code> or <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">volume</span> <span class="pre">prune</span></code> .</p>
</section>
<section id="bind-mounts">
<h2>Bind Mounts<a class="headerlink" href="#bind-mounts" title="Permalink to this headline">#</a></h2>
<p>Bind Mounts are very similiar to Volumes - the key difference is, that you, the developer, <strong>set the path on your host machine</strong> that should be connected to some path inside of a Container. You do that via -v/absolute/path/on/your/host/machine:/some/path/inside/of/container. The path in front of the : (i.e. the path on your host machine, to the folder that should be shared with the container) has to be an absolute path when using -v on the docker run command.</p>
<p>Bind Mounts are very useful for <strong>sharing data with a Container</strong> which might change whilst the container is running - e.g. your source code that you want to share with the Container running your development environment.</p>
<p><strong>Don’t use Bind Mounts if you just want to persist data</strong> - Named Volumes should be used for that (exception: You want to be able to inspect the data written during development). In general, Bind Mounts are a great tool during development - they’re not meant to be used in production (since you’re container should run isolated from it’s host machine).</p>
</section>
<section id="key-docker-commands">
<h2>Key Docker Commands<a class="headerlink" href="#key-docker-commands" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span> <span class="pre">-v</span> <span class="pre">/path/in/container</span> <span class="pre">IMAGE</span></code> : Create an <strong>Anonymous Volume</strong> inside a Container</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span> <span class="pre">-v</span> <span class="pre">some-name:/path/in/container</span> <span class="pre">IMAGE</span></code> : Create a *<em>Named Volume</em> (named some-name) inside a Container</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span> <span class="pre">-v</span> <span class="pre">/path/on/your/host/machine:path/in/container</span> <span class="pre">IMAGE</span></code>: Create a <strong>Bind Mount</strong> and connect a local path on your host machine to some path in the Container</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">volume</span> <span class="pre">ls</span></code> : List all currently active / stored Volumes (by all Containers)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">volume</span> <span class="pre">create</span> <span class="pre">VOL_NAME</span></code> : Create a new (Named) Volume named VOL_NAME. You
typically don’t need to do that, since Docker creates them automatically for you if they don’t exist when running a container</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">volume</span> <span class="pre">rm</span> <span class="pre">VOL_NAME</span></code> : Remove a Volume by it’s name (or ID)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">volume</span> <span class="pre">prune</span></code> : <strong>Remove all unused Volumes</strong> (i.e. not connected to a currently running or stopped container)</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "kunzhoudk/kzspace",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./docker"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="01-images-containers.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Images &amp; Containers</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="03-networks-requests.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Networks &amp; Requests</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Kun Zhou<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>